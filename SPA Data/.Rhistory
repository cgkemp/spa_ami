scale_fill_gradientn(colors = rev(rje::cubeHelix(gamma=1.0,
start=1.5,
r=-1.0,
hue=1.5,
n=16)),
name="Minutes \n of Travel") +
ggtitle("Travel Time to MOH") +
theme(axis.text=element_blank(),
panel.border=element_rect(fill=NA, color="white"))
print(full_plot)
loc <- tanzania[,c("longitude", "latitude")]
travel_time <- raster::extract(access.raster, loc)
tanzania <- cbind(tanzania, travel_time)
View(tanzania)
tanzania <- tanzania %>%
mutate(travel_time = na_if(travel_time, Inf))
saveRDS(tanzania, "tanzania.rds")
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
setwd("~/GitHub/spa_amitriptyline/SPA Data")
afghanistan <- readRDS("afghanistan.Rds")
bangladesh <- readRDS("bangladesh.Rds")
congo <- readRDS("congo.Rds")
haiti <- readRDS("haiti.Rds")
malawi <- readRDS("malawi.Rds")
nepal <- readRDS("nepal.Rds")
senegal <- readRDS("senegal.Rds")
tanzania <- readRDS("tanzania.Rds")
df <- bind_rows(afghanistan, bangladesh, congo, haiti, malawi, nepal, senegal, tanzania)
df <- df %>%
mutate("psychiatristsper100k" = case_when(
country== 'Afghanistan' ~ 0.23,
country== 'Bangladesh' ~ 0.13,
country== 'Democratic Republic of the Congo' ~ 0.08,
country== 'Haiti' ~ 0.07,
country== 'Malawi' ~ 0.01,
country== 'Nepal' ~ 0.36,
country== 'Senegal' ~ 0.2,
country== 'Tanzania' ~ 0.06)) %>%
mutate("mhnursesper100k" = case_when(
country== 'Afghanistan' ~ 0.1,
country== 'Bangladesh' ~ 0.87,
country== 'Democratic Republic of the Congo' ~ 0.5,
country== 'Haiti' ~ 0.2,
country== 'Malawi' ~ 0.22,
country== 'Nepal' ~ 0.56,
country== 'Senegal' ~ 0.27,
country== 'Tanzania' ~ 0.36)) %>%
mutate("psychologistsper100k" = case_when(
country== 'Afghanistan' ~ 0.3,
country== 'Bangladesh' ~ 0.12,
country== 'Democratic Republic of the Congo' ~ 0.02,
country== 'Haiti' ~ 0.56,
country== 'Malawi' ~ 0.02,
country== 'Nepal' ~ 0.52,
country== 'Senegal' ~ 0.02,
country== 'Tanzania' ~ 0.01)) %>%
mutate("mddpercentprevalence" = case_when(
country== 'Afghanistan' ~ 2.387806,
country== 'Bangladesh' ~ 2.7939406,
country== 'Democratic Republic of the Congo' ~ 2.25458,
country== 'Haiti' ~ 1.8508355,
country== 'Malawi' ~ 1.7241404,
country== 'Nepal' ~ 2.1452084,
country== 'Senegal' ~ 1.7020095,
country== 'Tanzania' ~ 1.9252937)) %>%
mutate(quarter = case_when(
month== 1 ~ 1,
month== 2 ~ 1,
month== 3 ~ 1,
month== 4 ~ 2,
month== 5 ~ 2,
month== 6 ~ 2,
month== 7 ~ 3,
month== 8 ~ 3,
month== 9 ~ 3,
month== 10 ~ 4,
month== 11 ~ 4,
month== 12 ~ 4)) %>%
mutate("country_code" = case_when(
country== 'Afghanistan' ~ 1,
country== 'Nepal' ~ 2,
country== 'Bangladesh' ~ 3,
country== 'Tanzania' ~ 4,
country== 'Senegal' ~ 5,
country== 'Haiti' ~ 6,
country== 'Democratic Republic of the Congo' ~ 7,
country== 'Malawi' ~ 8)) %>%
mutate(month=factor(month),
year=factor(year),
ownership=factor(ownership, levels = c(1,2,3,4), labels = c("Government/Public", "NGO/Private Not-For-Profit", "Private-For-Profit", "Mission/Faith-Based")),
facility_type=factor(facility_type),
country=factor(country),
worldbank=factor(worldbank)) %>%
mutate(staffcat = cut(total_staff, breaks=c(-Inf, 5, 10, 25, Inf)))
df$ownership[df$ownership == 9] <- NA ##Fix 1 facility in DRC
library(foreign)
write.dta(df, "clean_stata.dta")
saveRDS(df, "clean_R.Rds")
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
library(foreign)
library(ggplot2)
library(SpatialEpi)
library(readstata13)
library(xlsx)
library(doBy)
library(gdistance)
library(abind)
library(rje)
library(malariaAtlas)
library(raster)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- read_sas("Facility Inventory/bangladesh 2017/BDFC7ISDSP/BDFC7IFLSP.SAS7BDAT") #raw
bangladesh <- df %>%
mutate(rural = case_when(
FTYPE== 1 ~ 0,
FTYPE== 2 ~ 1)) %>%
mutate(facility_type = case_when(
FACTYPE== 2 ~ "primary",
FACTYPE== 3 ~ "other",
FACTYPE== 4 ~ "primary",
FACTYPE== 5 ~ "primary",
FACTYPE== 6 ~ "other",
FACTYPE== 7 ~ "other",
FACTYPE== 8 ~ "primary",
FACTYPE== 9 ~ "primary",
FACTYPE== 10 ~ "hospital",
FACTYPE== 11 ~ "hospital",
FACTYPE== 12 ~ "other",
FACTYPE== 1 ~ "hospital")) %>%
mutate(primary = case_when(
FACTYPE== 2 ~ 1,
FACTYPE== 3 ~ 0,
FACTYPE== 4 ~ 1,
FACTYPE== 5 ~ 1,
FACTYPE== 6 ~ 0,
FACTYPE== 7 ~ 0,
FACTYPE== 8 ~ 1,
FACTYPE== 9 ~ 1,
FACTYPE== 10 ~ 0,
FACTYPE== 11 ~ 0,
FACTYPE== 12 ~ 0,
FACTYPE== 1 ~ 0)) %>%
mutate(store_meds = case_when(
Q210==0 ~ 0,
Q210==1 ~ 1)) %>%
mutate(ncd_services = case_when(
Q102_14==0 ~ 0,
Q102_14==1 ~ 1)) %>%
mutate(amitriptyline = case_when(
Q903_16== 2 ~ 0,
Q903_16== 3 ~ 0,
Q903_16== 4 ~ 0,
Q903_16== 5 ~ 0,
Q903_16== 1 ~ 1)) %>%
mutate(total_staff = Q400AT) %>%
mutate(power = case_when(
Q340== 1 ~ 1,
Q340== 2 ~ 0)) %>%
mutate(improved_water = case_when(
Q330== 1 ~ 1,
Q330== 2 ~ 1,
Q330== 3 ~ 1,
Q330== 4 ~ 1,
Q330== 5 ~ 1,
Q330== 6 ~ 0,
Q330== 7 ~ 1,
Q330== 8 ~ 0,
Q330== 9 ~ 1,
Q330== 10 ~ 1,
Q330== 11 ~ 0,
Q330== 12 ~ 0,
Q330== 13 ~ 0,
Q330== 96 ~ 0,
Q330== 98 ~ 0,
Q330== 0 ~ 0)) %>%
mutate(improved_sanitation = case_when(
Q620== 11 ~ 1,
Q620== 12 ~ 1,
Q620== 13 ~ 1,
Q620== 14 ~ 1,
Q620== 15 ~ 1,
Q620== 21 ~ 1,
Q620== 22 ~ 0,
Q620== 23 ~ 0,
Q620== 31 ~ 0,
Q620== 41 ~ 0,
Q620== 51 ~ 0,
Q620== 61 ~ 0)) %>%
mutate(email = case_when(
Q322== 1 ~ 1, #yes
Q322== 2 ~ 0)) %>%
mutate(computer = case_when(
Q319== 1 ~ 1, #yes
Q319== 2 ~ 0)) %>%
mutate(general_opd_private_room = case_when(
Q1952== 1 ~ 1, #yes
Q1952== 2 ~ 1, #other room, but yes
Q1952== 3 ~ 0,
Q1952== 4 ~ 0)) %>%
mutate(ncd_private_room = case_when(
Q2352== 1 ~ 1, #yes
Q2352== 2 ~ 1, #other room, but yes
Q2352== 3 ~ 0,
Q2352== 4 ~ 0)) %>%
mutate(country = "Bangladesh",
worldbank = "Lower Middle Income") %>%
dplyr::rename(province = REGION,
district = DISTRICT,
facility_number = FACIL,
ownership = MGA,
month = MONTH,
year = YEAR) %>%
select(province, district, rural, facility_number, month, year, ownership, facility_type, primary, store_meds, ncd_services, amitriptyline,
total_staff, power, improved_water, improved_sanitation, email, computer, general_opd_private_room, ncd_private_room, country, worldbank)
library(foreign)
library(SpatialEpi)
#Import SPA lat/long
df_spatial <- read.dbf("Facility Inventory/bangladesh 2017/geo/BDGE7IFLSR.dbf") %>%
select(facility_number = SPAFACID, province_name = ADM1NAME, district_name = SPAREGNA, facility_type_name = SPATYPEN, ownership_name = SPAMANGN, latitude = LATNUM, longitude = LONGNUM) %>%
mutate(latitude = na_if(latitude,0),
longitude = na_if(longitude,0))
bangladesh <- bangladesh %>%
left_join(df_spatial, by="facility_number")
#Add travel time to central MOH
shape <- shapefile("Facility Inventory/bangladesh 2017/geo/bgd_admbnda_adm0_bbs_20201113.shp")
plot(shape, main="Shape for Clipping")
friction <- malariaAtlas::getRaster(
surface = "A global friction surface enumerating land-based travel speed for a nominal year 2015",
shp = shape)
malariaAtlas::autoplot_MAPraster(friction)
T <- gdistance::transition(friction, function(x) 1/mean(x), 8)
T.GC <- gdistance::geoCorrection(T)
point.locations <- read.csv(file = "Facility Inventory/bangladesh 2017/geo/moh_location.csv")
names(point.locations) <- c("X_COORD", "Y_COORD", "name")
coordinates(point.locations) <- ~ X_COORD + Y_COORD
proj4string(point.locations) <- proj4string(shape)
points <- as.matrix(point.locations@coords)
access.raster <- gdistance::accCost(T.GC, points)
p <- malariaAtlas::autoplot_MAPraster(access.raster,
shp_df=shape, printed=F)
full_plot <- p[[1]] + geom_point(data=data.frame(point.locations@coords),
aes(x=X_COORD, y=Y_COORD)) +
scale_fill_gradientn(colors = rev(rje::cubeHelix(gamma=1.0,
start=1.5,
r=-1.0,
hue=1.5,
n=16)),
name="Minutes \n of Travel") +
ggtitle("Travel Time to MOH") +
theme(axis.text=element_blank(),
panel.border=element_rect(fill=NA, color="white"))
print(full_plot)
loc <- bangladesh[,c("longitude", "latitude")]
travel_time <- raster::extract(access.raster, loc)
bangladesh <- cbind(bangladesh, travel_time)
bangladesh <- bangladesh %>%
mutate(travel_time = na_if(travel_time, Inf))
saveRDS(bangladesh, "bangladesh.rds")
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
setwd("~/GitHub/spa_amitriptyline/SPA Data")
afghanistan <- readRDS("afghanistan.Rds")
bangladesh <- readRDS("bangladesh.Rds")
congo <- readRDS("congo.Rds")
haiti <- readRDS("haiti.Rds")
malawi <- readRDS("malawi.Rds")
nepal <- readRDS("nepal.Rds")
senegal <- readRDS("senegal.Rds")
tanzania <- readRDS("tanzania.Rds")
df <- bind_rows(afghanistan, bangladesh, congo, haiti, malawi, nepal, senegal, tanzania)
df <- df %>%
mutate("psychiatristsper100k" = case_when(
country== 'Afghanistan' ~ 0.23,
country== 'Bangladesh' ~ 0.13,
country== 'Democratic Republic of the Congo' ~ 0.08,
country== 'Haiti' ~ 0.07,
country== 'Malawi' ~ 0.01,
country== 'Nepal' ~ 0.36,
country== 'Senegal' ~ 0.2,
country== 'Tanzania' ~ 0.06)) %>%
mutate("mhnursesper100k" = case_when(
country== 'Afghanistan' ~ 0.1,
country== 'Bangladesh' ~ 0.87,
country== 'Democratic Republic of the Congo' ~ 0.5,
country== 'Haiti' ~ 0.2,
country== 'Malawi' ~ 0.22,
country== 'Nepal' ~ 0.56,
country== 'Senegal' ~ 0.27,
country== 'Tanzania' ~ 0.36)) %>%
mutate("psychologistsper100k" = case_when(
country== 'Afghanistan' ~ 0.3,
country== 'Bangladesh' ~ 0.12,
country== 'Democratic Republic of the Congo' ~ 0.02,
country== 'Haiti' ~ 0.56,
country== 'Malawi' ~ 0.02,
country== 'Nepal' ~ 0.52,
country== 'Senegal' ~ 0.02,
country== 'Tanzania' ~ 0.01)) %>%
mutate("mddpercentprevalence" = case_when(
country== 'Afghanistan' ~ 2.387806,
country== 'Bangladesh' ~ 2.7939406,
country== 'Democratic Republic of the Congo' ~ 2.25458,
country== 'Haiti' ~ 1.8508355,
country== 'Malawi' ~ 1.7241404,
country== 'Nepal' ~ 2.1452084,
country== 'Senegal' ~ 1.7020095,
country== 'Tanzania' ~ 1.9252937)) %>%
mutate(quarter = case_when(
month== 1 ~ 1,
month== 2 ~ 1,
month== 3 ~ 1,
month== 4 ~ 2,
month== 5 ~ 2,
month== 6 ~ 2,
month== 7 ~ 3,
month== 8 ~ 3,
month== 9 ~ 3,
month== 10 ~ 4,
month== 11 ~ 4,
month== 12 ~ 4)) %>%
mutate("country_code" = case_when(
country== 'Afghanistan' ~ 1,
country== 'Nepal' ~ 2,
country== 'Bangladesh' ~ 3,
country== 'Tanzania' ~ 4,
country== 'Senegal' ~ 5,
country== 'Haiti' ~ 6,
country== 'Democratic Republic of the Congo' ~ 7,
country== 'Malawi' ~ 8)) %>%
mutate(month=factor(month),
year=factor(year),
ownership=factor(ownership, levels = c(1,2,3,4), labels = c("Government/Public", "NGO/Private Not-For-Profit", "Private-For-Profit", "Mission/Faith-Based")),
facility_type=factor(facility_type),
country=factor(country),
worldbank=factor(worldbank)) %>%
mutate(staffcat = cut(total_staff, breaks=c(-Inf, 5, 10, 25, Inf)))
df$ownership[df$ownership == 9] <- NA ##Fix 1 facility in DRC
library(foreign)
write.dta(df, "clean_stata.dta")
saveRDS(df, "clean_R.Rds")
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
library(foreign)
library(ggplot2)
library(SpatialEpi)
library(readstata13)
library(xlsx)
library(doBy)
library(gdistance)
library(abind)
library(rje)
library(malariaAtlas)
library(raster)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- read_sas("Facility Inventory/bangladesh 2017/BDFC7ISDSP/BDFC7IFLSP.SAS7BDAT") #raw
bangladesh <- df %>%
mutate(rural = case_when(
FTYPE== 1 ~ 0,
FTYPE== 2 ~ 1)) %>%
mutate(facility_type = case_when(
FACTYPE== 2 ~ "primary",
FACTYPE== 3 ~ "other",
FACTYPE== 4 ~ "primary",
FACTYPE== 5 ~ "primary",
FACTYPE== 6 ~ "other",
FACTYPE== 7 ~ "other",
FACTYPE== 8 ~ "primary",
FACTYPE== 9 ~ "primary",
FACTYPE== 10 ~ "hospital",
FACTYPE== 11 ~ "hospital",
FACTYPE== 12 ~ "other",
FACTYPE== 1 ~ "hospital")) %>%
mutate(primary = case_when(
FACTYPE== 2 ~ 1,
FACTYPE== 3 ~ 0,
FACTYPE== 4 ~ 1,
FACTYPE== 5 ~ 1,
FACTYPE== 6 ~ 0,
FACTYPE== 7 ~ 0,
FACTYPE== 8 ~ 1,
FACTYPE== 9 ~ 1,
FACTYPE== 10 ~ 0,
FACTYPE== 11 ~ 0,
FACTYPE== 12 ~ 0,
FACTYPE== 1 ~ 0)) %>%
mutate(store_meds = case_when(
Q210==0 ~ 0,
Q210==1 ~ 1)) %>%
mutate(ncd_services = case_when(
Q102_14==0 ~ 0,
Q102_14==1 ~ 1)) %>%
mutate(amitriptyline = case_when(
Q903_16== 2 ~ 0,
Q903_16== 3 ~ 0,
Q903_16== 4 ~ 0,
Q903_16== 5 ~ 0,
Q903_16== 1 ~ 1)) %>%
mutate(total_staff = Q400AT) %>%
mutate(power = case_when(
Q340== 1 ~ 1,
Q340== 2 ~ 0)) %>%
mutate(improved_water = case_when(
Q330== 1 ~ 1,
Q330== 2 ~ 1,
Q330== 3 ~ 1,
Q330== 4 ~ 1,
Q330== 5 ~ 1,
Q330== 6 ~ 0,
Q330== 7 ~ 1,
Q330== 8 ~ 0,
Q330== 9 ~ 1,
Q330== 10 ~ 1,
Q330== 11 ~ 0,
Q330== 12 ~ 0,
Q330== 13 ~ 0,
Q330== 96 ~ 0,
Q330== 98 ~ 0,
Q330== 0 ~ 0)) %>%
mutate(improved_sanitation = case_when(
Q620== 11 ~ 1,
Q620== 12 ~ 1,
Q620== 13 ~ 1,
Q620== 14 ~ 1,
Q620== 15 ~ 1,
Q620== 21 ~ 1,
Q620== 22 ~ 0,
Q620== 23 ~ 0,
Q620== 31 ~ 0,
Q620== 41 ~ 0,
Q620== 51 ~ 0,
Q620== 61 ~ 0)) %>%
mutate(email = case_when(
Q322== 1 ~ 1, #yes
Q322== 2 ~ 0)) %>%
mutate(computer = case_when(
Q319== 1 ~ 1, #yes
Q319== 2 ~ 0)) %>%
mutate(general_opd_private_room = case_when(
Q1952== 1 ~ 1, #yes
Q1952== 2 ~ 1, #other room, but yes
Q1952== 3 ~ 0,
Q1952== 4 ~ 0)) %>%
mutate(ncd_private_room = case_when(
Q2352== 1 ~ 1, #yes
Q2352== 2 ~ 1, #other room, but yes
Q2352== 3 ~ 0,
Q2352== 4 ~ 0)) %>%
mutate(country = "Bangladesh",
worldbank = "Lower Middle Income") %>%
dplyr::rename(province = REGION,
district = DISTRICT,
facility_number = FACIL,
ownership = MGA,
month = MONTH,
year = YEAR) %>%
select(province, district, rural, facility_number, month, year, ownership, facility_type, primary, store_meds, ncd_services, amitriptyline,
total_staff, power, improved_water, improved_sanitation, email, computer, general_opd_private_room, ncd_private_room, country, worldbank)
library(foreign)
library(SpatialEpi)
#Import SPA lat/long
df_spatial <- read.dbf("Facility Inventory/bangladesh 2017/geo/BDGE7IFLSR.dbf") %>%
select(facility_number = SPAFACID, province_name = ADM1NAME, district_name = SPAREGNA, facility_type_name = SPATYPEN, ownership_name = SPAMANGN, latitude = LATNUM, longitude = LONGNUM) %>%
mutate(latitude = na_if(latitude,0),
longitude = na_if(longitude,0))
bangladesh <- bangladesh %>%
left_join(df_spatial, by="facility_number")
View(bangladesh)
plot(df_spatial, aes(x=longitude, y=latitude))
shape <- shapefile("Facility Inventory/bangladesh 2017/geo/bgd_admbnda_adm0_bbs_20201113.shp")
plot(shape, main="Shape for Clipping")
friction <- malariaAtlas::getRaster(
surface = "A global friction surface enumerating land-based travel speed for a nominal year 2015",
shp = shape)
malariaAtlas::autoplot_MAPraster(friction)
T <- gdistance::transition(friction, function(x) 1/mean(x), 8)
T.GC <- gdistance::geoCorrection(T)
point.locations <- read.csv(file = "Facility Inventory/bangladesh 2017/geo/moh_location.csv")
View(point.locations)
names(point.locations) <- c("X_COORD", "Y_COORD", "name")
coordinates(point.locations) <- ~ X_COORD + Y_COORD
proj4string(point.locations) <- proj4string(shape)
points <- as.matrix(point.locations@coords)
access.raster <- gdistance::accCost(T.GC, points)
p <- malariaAtlas::autoplot_MAPraster(access.raster,
shp_df=shape, printed=F)
full_plot <- p[[1]] + geom_point(data=data.frame(point.locations@coords),
aes(x=X_COORD, y=Y_COORD)) +
scale_fill_gradientn(colors = rev(rje::cubeHelix(gamma=1.0,
start=1.5,
r=-1.0,
hue=1.5,
n=16)),
name="Minutes \n of Travel") +
ggtitle("Travel Time to MOH") +
theme(axis.text=element_blank(),
panel.border=element_rect(fill=NA, color="white"))
print(full_plot)
loc <- bangladesh[,c("longitude", "latitude")]
travel_time <- raster::extract(access.raster, loc)
bangladesh <- cbind(bangladesh, travel_time)
bangladesh <- bangladesh %>%
mutate(travel_time = na_if(travel_time, Inf))
