country== 'Haiti' ~ 1.8508355,
country== 'Malawi' ~ 1.7241404,
country== 'Nepal' ~ 2.1452084,
country== 'Senegal' ~ 1.7020095,
country== 'Tanzania' ~ 1.9252937)) %>%
mutate(quarter = case_when(
month== 1 ~ 1,
month== 2 ~ 1,
month== 3 ~ 1,
month== 4 ~ 2,
month== 5 ~ 2,
month== 6 ~ 2,
month== 7 ~ 3,
month== 8 ~ 3,
month== 9 ~ 3,
month== 10 ~ 4,
month== 11 ~ 4,
month== 12 ~ 4)) %>%
mutate(month=factor(month),
year=factor(year),
ownership=factor(ownership, levels = c(1,2,3,4), labels = c("Government/Public", "NGO/Private Not-For-Profit", "Private-For-Profit", "Mission/Faith-Based")),
facility_type=factor(facility_type),
country=factor(country),
worldbank=factor(worldbank)) %>%
mutate(staffcat = cut(total_staff, breaks=c(0, 5, 10, 25, Inf)))
df$ownership[df$ownership == 9] <- NA ##Fix 1 facility in DRC
library(foreign)
write.dta(df, "clean_stata.dta")
saveRDS(df, "clean_R.Rds")
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
setwd("~/GitHub/spa_amitriptyline/SPA Data")
afghanistan <- readRDS("afghanistan.Rds")
bangladesh <- readRDS("bangladesh.Rds")
congo <- readRDS("congo.Rds")
haiti <- readRDS("haiti.Rds")
malawi <- readRDS("malawi.Rds")
nepal <- readRDS("nepal.Rds")
senegal2012 <- readRDS("senegal2012.Rds")
senegal2014 <- readRDS("senegal2014.Rds")
senegal2015 <- readRDS("senegal2015.Rds")
senegal2016 <- readRDS("senegal2016.Rds")
senegal2017 <- readRDS("senegal2017.Rds")
senegal2018 <- readRDS("senegal2018.Rds")
tanzania <- readRDS("tanzania.Rds")
df <- bind_rows(afghanistan, bangladesh, congo, haiti, malawi, nepal, senegal2012, senegal2014, senegal2015, senegal2016, senegal2017, senegal2017, senegal2018, tanzania)
df <- df %>%
mutate("psychiatristsper100k" = case_when(
country== 'Afghanistan' ~ 0.23,
country== 'Bangladesh' ~ 0.13,
country== 'Democratic Republic of the Congo' ~ 0.08,
country== 'Haiti' ~ 0.07,
country== 'Malawi' ~ 0.01,
country== 'Nepal' ~ 0.36,
country== 'Senegal' ~ 0.2,
country== 'Tanzania' ~ 0.06)) %>%
mutate("mhnursesper100k" = case_when(
country== 'Afghanistan' ~ 0.1,
country== 'Bangladesh' ~ 0.87,
country== 'Congo' ~ 0.5,
country== 'Haiti' ~ 0.2,
country== 'Malawi' ~ 0.22,
country== 'Nepal' ~ 0.56,
country== 'Senegal' ~ 0.27,
country== 'Tanzania' ~ 0.36)) %>%
mutate("psychologistsper100k" = case_when(
country== 'Afghanistan' ~ 0.3,
country== 'Bangladesh' ~ 0.12,
country== 'Congo' ~ 0.02,
country== 'Haiti' ~ 0.56,
country== 'Malawi' ~ 0.02,
country== 'Nepal' ~ 0.52,
country== 'Senegal' ~ 0.02,
country== 'Tanzania' ~ 0.01)) %>%
mutate("mddpercentprevalence" = case_when(
country== 'Afghanistan' ~ 2.387806,
country== 'Bangladesh' ~ 2.7939406,
country== 'Congo' ~ 2.25458,
country== 'Haiti' ~ 1.8508355,
country== 'Malawi' ~ 1.7241404,
country== 'Nepal' ~ 2.1452084,
country== 'Senegal' ~ 1.7020095,
country== 'Tanzania' ~ 1.9252937)) %>%
mutate(quarter = case_when(
month== 1 ~ 1,
month== 2 ~ 1,
month== 3 ~ 1,
month== 4 ~ 2,
month== 5 ~ 2,
month== 6 ~ 2,
month== 7 ~ 3,
month== 8 ~ 3,
month== 9 ~ 3,
month== 10 ~ 4,
month== 11 ~ 4,
month== 12 ~ 4)) %>%
mutate(month=factor(month),
year=factor(year),
ownership=factor(ownership, levels = c(1,2,3,4), labels = c("Government/Public", "NGO/Private Not-For-Profit", "Private-For-Profit", "Mission/Faith-Based")),
facility_type=factor(facility_type),
country=factor(country),
worldbank=factor(worldbank)) %>%
mutate(staffcat = cut(total_staff, breaks=c(-Inf, 5, 10, 25, Inf)))
df$ownership[df$ownership == 9] <- NA ##Fix 1 facility in DRC
library(foreign)
write.dta(df, "clean_stata.dta")
saveRDS(df, "clean_R.Rds")
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$Nation <- as.factor(df$Nation)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(df$mddpercentprevalence)) / sd(df$mddpercentprevalence)
df$psychiatristsper100k_std <- (df$psychiatristsper100k_std - mean(df$psychiatristsper100k_std)) / sd(df$psychiatristsper100k_std)
##Table 1
df_tableone <- subset(df, !is.na(amitriptyline))
vars <- c("staffcat", "ownership", "facility_type", "power", "improved_water", "improved_sanitation", "computer", "email", "country", "general_opd_private_room")
cat_vars <- c("staffcat", "ownership", "facility_type", "power", "improved_water", "improved_sanitation", "computer", "email", "country", "general_opd_private_room")
table_one <- CreateTableOne(data = df_tableone, vars=vars,  factorVars = cat_vars, strata=c("amitriptyline"), addOverall=T)
table_one.tableMat <- print(table_one, quote = FALSE, noSpaces = TRUE, printToggle = FALSE)
write.csv(table_one.tableMat, file = "table_one.csv")
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$Nation <- as.factor(df$Nation)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(df$mddpercentprevalence)) / sd(df$mddpercentprevalence)
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(df$psychiatristsper100k)) / sd(df$psychiatristsper100k)
##Table 1
df_tableone <- subset(df, !is.na(amitriptyline))
vars <- c("staffcat", "ownership", "facility_type", "power", "improved_water", "improved_sanitation", "computer", "email", "country", "general_opd_private_room")
cat_vars <- c("staffcat", "ownership", "facility_type", "power", "improved_water", "improved_sanitation", "computer", "email", "country", "general_opd_private_room")
table_one <- CreateTableOne(data = df_tableone, vars=vars,  factorVars = cat_vars, strata=c("amitriptyline"), addOverall=T)
table_one.tableMat <- print(table_one, quote = FALSE, noSpaces = TRUE, printToggle = FALSE)
write.csv(table_one.tableMat, file = "table_one.csv")
library('lme4')
formula1 <- (amitriptyline) ~ staffcat + ownership + facility_type +
(1 | country)
formula2 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
(1 | country)
formula3 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
worldbank + mddpercentprevalence_std + psychiatristsper100k_std   +
(1 | country)
formulas <- list(formula1, formula2, formula3)
models <- lapply(formulas, function(f) glmer(f, family= binomial(link = "logit"), data = df))
library(sjPlot)
tab_model(models[[1]], models[[2]], models[[3]], file="regressiontable.html")
is.factor(df$country)
View(df)
df$country <- as.factor(df$country)
models <- lapply(formulas, function(f) glmer(f, family= binomial(link = "logit"), data = df))
is.factor(df$amitriptyline)
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
setwd("~/GitHub/spa_amitriptyline/SPA Data")
afghanistan <- readRDS("afghanistan.Rds")
bangladesh <- readRDS("bangladesh.Rds")
congo <- readRDS("congo.Rds")
haiti <- readRDS("haiti.Rds")
malawi <- readRDS("malawi.Rds")
nepal <- readRDS("nepal.Rds")
senegal2012 <- readRDS("senegal2012.Rds")
senegal2014 <- readRDS("senegal2014.Rds")
senegal2015 <- readRDS("senegal2015.Rds")
senegal2016 <- readRDS("senegal2016.Rds")
senegal2017 <- readRDS("senegal2017.Rds")
senegal2018 <- readRDS("senegal2018.Rds")
tanzania <- readRDS("tanzania.Rds")
df <- bind_rows(afghanistan, bangladesh, congo, haiti, malawi, nepal, senegal2012, senegal2014, senegal2015, senegal2016, senegal2017, senegal2017, senegal2018, tanzania)
df <- df %>%
mutate("psychiatristsper100k" = case_when(
country== 'Afghanistan' ~ 0.23,
country== 'Bangladesh' ~ 0.13,
country== 'Democratic Republic of the Congo' ~ 0.08,
country== 'Haiti' ~ 0.07,
country== 'Malawi' ~ 0.01,
country== 'Nepal' ~ 0.36,
country== 'Senegal' ~ 0.2,
country== 'Tanzania' ~ 0.06)) %>%
mutate("mhnursesper100k" = case_when(
country== 'Afghanistan' ~ 0.1,
country== 'Bangladesh' ~ 0.87,
country== 'Congo' ~ 0.5,
country== 'Haiti' ~ 0.2,
country== 'Malawi' ~ 0.22,
country== 'Nepal' ~ 0.56,
country== 'Senegal' ~ 0.27,
country== 'Tanzania' ~ 0.36)) %>%
mutate("psychologistsper100k" = case_when(
country== 'Afghanistan' ~ 0.3,
country== 'Bangladesh' ~ 0.12,
country== 'Congo' ~ 0.02,
country== 'Haiti' ~ 0.56,
country== 'Malawi' ~ 0.02,
country== 'Nepal' ~ 0.52,
country== 'Senegal' ~ 0.02,
country== 'Tanzania' ~ 0.01)) %>%
mutate("mddpercentprevalence" = case_when(
country== 'Afghanistan' ~ 2.387806,
country== 'Bangladesh' ~ 2.7939406,
country== 'Congo' ~ 2.25458,
country== 'Haiti' ~ 1.8508355,
country== 'Malawi' ~ 1.7241404,
country== 'Nepal' ~ 2.1452084,
country== 'Senegal' ~ 1.7020095,
country== 'Tanzania' ~ 1.9252937)) %>%
mutate(quarter = case_when(
month== 1 ~ 1,
month== 2 ~ 1,
month== 3 ~ 1,
month== 4 ~ 2,
month== 5 ~ 2,
month== 6 ~ 2,
month== 7 ~ 3,
month== 8 ~ 3,
month== 9 ~ 3,
month== 10 ~ 4,
month== 11 ~ 4,
month== 12 ~ 4)) %>%
mutate("country_code" = case_when(
country== 'Afghanistan' ~ 1,
country== 'Nepal' ~ 2,
country== 'Bangladesh' ~ 3,
country== 'Tanzania' ~ 4,
country== 'Senegal' ~ 5,
country== 'Haiti' ~ 6,
country== 'Democratic Republic of the Congo' ~ 7,
country== 'Malawi' ~ 8)) %>%
mutate(month=factor(month),
year=factor(year),
ownership=factor(ownership, levels = c(1,2,3,4), labels = c("Government/Public", "NGO/Private Not-For-Profit", "Private-For-Profit", "Mission/Faith-Based")),
facility_type=factor(facility_type),
country=factor(country),
worldbank=factor(worldbank)) %>%
mutate(staffcat = cut(total_staff, breaks=c(-Inf, 5, 10, 25, Inf)))
df$ownership[df$ownership == 9] <- NA ##Fix 1 facility in DRC
library(foreign)
write.dta(df, "clean_stata.dta")
saveRDS(df, "clean_R.Rds")
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$country <- as.factor(df$country)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(df$mddpercentprevalence)) / sd(df$mddpercentprevalence)
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(df$psychiatristsper100k)) / sd(df$psychiatristsper100k)
library('lme4')
formula1 <- (amitriptyline) ~ staffcat + ownership + facility_type +
(1 | country_code)
formula2 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
(1 | country_code)
formula3 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
worldbank + mddpercentprevalence_std + psychiatristsper100k_std   +
(1 | country_code)
formulas <- list(formula1, formula2, formula3)
models <- lapply(formulas, function(f) glmer(f, family= binomial(link = "logit"), data = df))
models <- glmer(formula1, family= binomial(link = "logit"), data = df))
models <- glmer(formula1, family= binomial(link = "logit"), data = df)
summary(models)
formula1 <- (amitriptyline) ~ staffcat + ownership + facility_type +
(1 | country)
formulas <- list(formula1, formula2, formula3)
models <- glmer(formula1, family= binomial(link = "logit"), data = df)
summary(models)
models <- glmer(formula2, family= binomial(link = "logit"), data = df)
summary(models)
models <- glmer(formula3, family= binomial(link = "logit"), data = df)
formula3 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
worldbank +
(1 | country_code)
formulas <- list(formula1, formula2, formula3)
models <- glmer(formula3, family= binomial(link = "logit"), data = df)
View(df)
View(df)
View(df)
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$country <- as.factor(df$country)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(na.omit(df$mddpercentprevalence)) / sd(na.omit(df$mddpercentprevalence))
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(na.omit(df$psychiatristsper100k))) / sd(na.omit(df$psychiatristsper100k))
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(na.omit(df$mddpercentprevalence)) / sd(na.omit(df$mddpercentprevalence))
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(na.omit(df$psychiatristsper100k)) / sd(na.omit(df$psychiatristsper100k))
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$country <- as.factor(df$country)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(na.omit(df$mddpercentprevalence))) / sd(na.omit(df$mddpercentprevalence))
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(na.omit(df$psychiatristsper100k))) / sd(na.omit(df$psychiatristsper100k))
rm(list = ls())
library("tidyverse")
library("haven")
library("dplyr")
setwd("~/GitHub/spa_amitriptyline/SPA Data")
afghanistan <- readRDS("afghanistan.Rds")
bangladesh <- readRDS("bangladesh.Rds")
congo <- readRDS("congo.Rds")
haiti <- readRDS("haiti.Rds")
malawi <- readRDS("malawi.Rds")
nepal <- readRDS("nepal.Rds")
senegal2012 <- readRDS("senegal2012.Rds")
senegal2014 <- readRDS("senegal2014.Rds")
senegal2015 <- readRDS("senegal2015.Rds")
senegal2016 <- readRDS("senegal2016.Rds")
senegal2017 <- readRDS("senegal2017.Rds")
senegal2018 <- readRDS("senegal2018.Rds")
tanzania <- readRDS("tanzania.Rds")
df <- bind_rows(afghanistan, bangladesh, congo, haiti, malawi, nepal, senegal2012, senegal2014, senegal2015, senegal2016, senegal2017, senegal2017, senegal2018, tanzania)
df <- df %>%
mutate("psychiatristsper100k" = case_when(
country== 'Afghanistan' ~ 0.23,
country== 'Bangladesh' ~ 0.13,
country== 'Democratic Republic of the Congo' ~ 0.08,
country== 'Haiti' ~ 0.07,
country== 'Malawi' ~ 0.01,
country== 'Nepal' ~ 0.36,
country== 'Senegal' ~ 0.2,
country== 'Tanzania' ~ 0.06)) %>%
mutate("mhnursesper100k" = case_when(
country== 'Afghanistan' ~ 0.1,
country== 'Bangladesh' ~ 0.87,
country== 'Democratic Republic of the Congo' ~ 0.5,
country== 'Haiti' ~ 0.2,
country== 'Malawi' ~ 0.22,
country== 'Nepal' ~ 0.56,
country== 'Senegal' ~ 0.27,
country== 'Tanzania' ~ 0.36)) %>%
mutate("psychologistsper100k" = case_when(
country== 'Afghanistan' ~ 0.3,
country== 'Bangladesh' ~ 0.12,
country== 'Democratic Republic of the Congo' ~ 0.02,
country== 'Haiti' ~ 0.56,
country== 'Malawi' ~ 0.02,
country== 'Nepal' ~ 0.52,
country== 'Senegal' ~ 0.02,
country== 'Tanzania' ~ 0.01)) %>%
mutate("mddpercentprevalence" = case_when(
country== 'Afghanistan' ~ 2.387806,
country== 'Bangladesh' ~ 2.7939406,
country== 'Democratic Republic of the Congo' ~ 2.25458,
country== 'Haiti' ~ 1.8508355,
country== 'Malawi' ~ 1.7241404,
country== 'Nepal' ~ 2.1452084,
country== 'Senegal' ~ 1.7020095,
country== 'Tanzania' ~ 1.9252937)) %>%
mutate(quarter = case_when(
month== 1 ~ 1,
month== 2 ~ 1,
month== 3 ~ 1,
month== 4 ~ 2,
month== 5 ~ 2,
month== 6 ~ 2,
month== 7 ~ 3,
month== 8 ~ 3,
month== 9 ~ 3,
month== 10 ~ 4,
month== 11 ~ 4,
month== 12 ~ 4)) %>%
mutate("country_code" = case_when(
country== 'Afghanistan' ~ 1,
country== 'Nepal' ~ 2,
country== 'Bangladesh' ~ 3,
country== 'Tanzania' ~ 4,
country== 'Senegal' ~ 5,
country== 'Haiti' ~ 6,
country== 'Democratic Republic of the Congo' ~ 7,
country== 'Malawi' ~ 8)) %>%
mutate(month=factor(month),
year=factor(year),
ownership=factor(ownership, levels = c(1,2,3,4), labels = c("Government/Public", "NGO/Private Not-For-Profit", "Private-For-Profit", "Mission/Faith-Based")),
facility_type=factor(facility_type),
country=factor(country),
worldbank=factor(worldbank)) %>%
mutate(staffcat = cut(total_staff, breaks=c(-Inf, 5, 10, 25, Inf)))
df$ownership[df$ownership == 9] <- NA ##Fix 1 facility in DRC
library(foreign)
write.dta(df, "clean_stata.dta")
saveRDS(df, "clean_R.Rds")
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$country <- as.factor(df$country)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(na.omit(df$mddpercentprevalence))) / sd(na.omit(df$mddpercentprevalence))
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(na.omit(df$psychiatristsper100k))) / sd(na.omit(df$psychiatristsper100k))
rm(list = ls())
library(tidyverse)
library(haven)
library(dplyr)
library(tableone)
setwd("~/GitHub/spa_amitriptyline/SPA Data")
df <- readRDS("clean_R.Rds")
#df$PowerSource <-as.factor(df$Power_Source)
#df$EmailInternet <-as.factor(df$Email_or_Internet_Access)
#df$Staff <-as.factor(df$Staff)
#df$Sanitation <-as.factor(df$Sanitation)
#df$Amitriptyline <-as.factor(df$Amitriptyline)
#df$MonthGrouped <-as.factor(df$Month_Grouped)
#df$country <- as.factor(df$country)
#df$Computer <- as.factor(df$Computer)
#df$WaterSource <-as.factor(df$Water_Source)
df$mddpercentprevalence_std <- (df$mddpercentprevalence - mean(na.omit(df$mddpercentprevalence))) / sd(na.omit(df$mddpercentprevalence))
df$psychiatristsper100k_std <- (df$psychiatristsper100k - mean(na.omit(df$psychiatristsper100k))) / sd(na.omit(df$psychiatristsper100k))
##Table 1
df_tableone <- subset(df, !is.na(amitriptyline))
vars <- c("staffcat", "ownership", "facility_type", "power", "improved_water", "improved_sanitation", "computer", "email", "country", "general_opd_private_room")
cat_vars <- c("staffcat", "ownership", "facility_type", "power", "improved_water", "improved_sanitation", "computer", "email", "country", "general_opd_private_room")
table_one <- CreateTableOne(data = df_tableone, vars=vars,  factorVars = cat_vars, strata=c("amitriptyline"), addOverall=T)
table_one.tableMat <- print(table_one, quote = FALSE, noSpaces = TRUE, printToggle = FALSE)
write.csv(table_one.tableMat, file = "table_one.csv")
library('lme4')
formula1 <- (amitriptyline) ~ staffcat + ownership + facility_type +
(1 | country)
formula1 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
(1 | country_code)
formula3 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
worldbank + mddpercentprevalence_std + psychiatristsper100k_std   +
(1 | country_code)
formulas <- list(formula1, formula2, formula3)
models <- lapply(formulas, function(f) glmer(f, family= binomial(link = "logit"), data = df))
formula1 <- (amitriptyline) ~ staffcat + ownership + facility_type +
(1 | country)
formula2 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
(1 | country_code)
formula3 <- (amitriptyline) ~ staffcat + ownership + facility_type +
power + improved_water + improved_sanitation + computer + email +
worldbank + mddpercentprevalence_std + psychiatristsper100k_std   +
(1 | country_code)
formulas <- list(formula1, formula2, formula3)
models <- lapply(formulas, function(f) glmer(f, family= binomial(link = "logit"), data = df))
library(sjPlot)
tab_model(models[[1]], models[[2]], models[[3]], file="regressiontable.html")
